<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage Services - LocalServe Admin</title>
    <link rel="stylesheet" href="../css/base.css">
    <link rel="stylesheet" href="../css/dashboard.css">
</head>
<body>
    <div class="dashboard-wrapper">
        <aside class="sidebar">
            <div class="sidebar-header">
                <h2>LocalServe Admin</h2>
                <p id="userName">Administrator</p>
            </div>
            <nav class="sidebar-nav">
                <a href="dashboard.html" class="nav-item">
                    <span>üìä</span> Dashboard
                </a>
                <a href="manage-users.html" class="nav-item">
                    <span>üë•</span> Manage Users
                </a>
                <a href="manage-services.html" class="nav-item active">
                    <span>üîß</span> Manage Services
                </a>
                <a href="manage-payments.html" class="nav-item">
                    <span>üí≥</span> Manage Payments
                </a>
                <a href="reports.html" class="nav-item">
                    <span>üìà</span> Reports
                </a>
                <a href="#" class="nav-item" id="logoutBtn">
                    <span>üö™</span> Logout
                </a>
            </nav>
        </aside>

        <main class="main-content">
            <header class="content-header">
                <h1>Manage Services</h1>
                <div class="header-actions">
                    <button class="btn-secondary" id="exportServicesBtn">Export Services</button>
                </div>
            </header>

            <div class="filters-section">
                <div class="search-bar">
                    <input type="text" id="searchServices" placeholder="Search services or providers...">
                    <button class="btn-primary">Search</button>
                </div>
                <div class="filter-options">
                    <select id="categoryFilter">
                        <option value="">All Categories</option>
                        <option value="cleaning">Home Cleaning</option>
                        <option value="plumbing">Plumbing</option>
                        <option value="electrical">Electrical</option>
                        <option value="gardening">Gardening</option>
                        <option value="carpentry">Carpentry</option>
                        <option value="painting">Painting</option>
                    </select>
                    <select id="statusFilter">
                        <option value="">All Status</option>
                        <option value="active">Active</option>
                        <option value="inactive">Inactive</option>
                        <option value="pending">Pending Approval</option>
                        <option value="suspended">Suspended</option>
                    </select>
                    <select id="sortBy">
                        <option value="newest">Newest First</option>
                        <option value="popular">Most Popular</option>
                        <option value="rating">Highest Rated</option>
                        <option value="price-low">Price: Low to High</option>
                        <option value="price-high">Price: High to Low</option>
                    </select>
                </div>
            </div>

            <div class="dashboard-grid">
                <div class="stat-card">
                    <div class="stat-icon">üîß</div>
                    <div class="stat-content">
                        <h3 id="totalServices">0</h3>
                        <p>Total Services</p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon">‚úÖ</div>
                    <div class="stat-content">
                        <h3 id="activeServices">0</h3>
                        <p>Active Services</p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon">‚è≥</div>
                    <div class="stat-content">
                        <h3 id="pendingServices">0</h3>
                        <p>Pending Approval</p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon">üìã</div>
                    <div class="stat-content">
                        <h3 id="totalBookings">0</h3>
                        <p>Total Bookings</p>
                    </div>
                </div>
            </div>

            <div class="tabs">
                <button class="tab-btn active" data-tab="all">All Services</button>
                <button class="tab-btn" data-tab="active">Active</button>
                <button class="tab-btn" data-tab="pending">Pending</button>
                <button class="tab-btn" data-tab="suspended">Suspended</button>
            </div>

            <div class="tab-content active" id="all">
                <div class="content-section">
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Service Name</th>
                                    <th>Provider</th>
                                    <th>Category</th>
                                    <th>Price</th>
                                    <th>Rating</th>
                                    <th>Bookings</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="servicesTableBody">
                                <tr>
                                    <td colspan="8" class="no-data">Loading services...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="tab-content" id="active">
                <div class="content-section">
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Service Name</th>
                                    <th>Provider</th>
                                    <th>Category</th>
                                    <th>Price</th>
                                    <th>Rating</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="activeServicesTable">
                                <tr>
                                    <td colspan="6" class="no-data">No active services</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="tab-content" id="pending">
                <div class="content-section">
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Service Name</th>
                                    <th>Provider</th>
                                    <th>Category</th>
                                    <th>Submitted Date</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="pendingServicesTable">
                                <tr>
                                    <td colspan="5" class="no-data">No pending services</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="tab-content" id="suspended">
                <div class="content-section">
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Service Name</th>
                                    <th>Provider</th>
                                    <th>Reason</th>
                                    <th>Suspended Date</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="suspendedServicesTable">
                                <tr>
                                    <td colspan="5" class="no-data">No suspended services</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- View Service Modal -->
    <div id="serviceModal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <span class="close">&times;</span>
            <h2>Service Details</h2>
            <div id="serviceDetailsContent">
                <!-- Service details will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Approve/Reject Modal -->
    <div id="approvalModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Service Approval</h2>
            <form id="approvalForm">
                <input type="hidden" id="serviceId">
                <div class="form-group">
                    <label for="approvalAction">Action</label>
                    <select id="approvalAction" required>
                        <option value="approve">Approve Service</option>
                        <option value="reject">Reject Service</option>
                    </select>
                </div>
                <div class="form-group" id="rejectionReasonGroup" style="display: none;">
                    <label for="rejectionReason">Rejection Reason</label>
                    <textarea id="rejectionReason" rows="4" required></textarea>
                </div>
                <div class="form-group">
                    <label for="adminNotes">Admin Notes (Optional)</label>
                    <textarea id="adminNotes" rows="3"></textarea>
                </div>
                <button type="submit" class="btn-primary btn-full">Submit</button>
            </form>
        </div>
    </div>

    <script src="../js/api.js"></script>
    <script src="../js/admin.js"></script>
    <script src="../js/notifications.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            loadServicesPage();
            setupServiceFilters();
            setupServiceTabs();
            setupServiceModals();
        });

        function loadServicesPage() {
            const services = [
                {
                    id: 1,
                    name: 'Weekly Home Cleaning',
                    provider: 'Clean Pro Services',
                    category: 'cleaning',
                    price: 49.99,
                    rating: 4.8,
                    bookings: 124,
                    status: 'active'
                },
                {
                    id: 2,
                    name: 'Emergency Plumbing',
                    provider: 'Fix It Fast',
                    category: 'plumbing',
                    price: 89.99,
                    rating: 4.9,
                    bookings: 89,
                    status: 'active'
                },
                {
                    id: 3,
                    name: 'Garden Maintenance',
                    provider: 'Green Thumb',
                    category: 'gardening',
                    price: 59.99,
                    rating: 4.6,
                    bookings: 45,
                    status: 'pending'
                }
            ];

            document.getElementById('totalServices').textContent = services.length;
            document.getElementById('activeServices').textContent = services.filter(s => s.status === 'active').length;
            document.getElementById('pendingServices').textContent = services.filter(s => s.status === 'pending').length;
            document.getElementById('totalBookings').textContent = services.reduce((sum, s) => sum + s.bookings, 0);

            const tbody = document.getElementById('servicesTableBody');
            tbody.innerHTML = services.map(service => `
                <tr>
                    <td>${service.name}</td>
                    <td>${service.provider}</td>
                    <td><span class="status-badge">${service.category}</span></td>
                    <td>${utils.formatCurrency(service.price)}</td>
                    <td>‚≠ê ${service.rating}</td>
                    <td>${service.bookings}</td>
                    <td><span class="status-badge status-${service.status}">${service.status}</span></td>
                    <td>
                        <button class="btn-primary" style="padding: 6px 12px; font-size: 12px; margin-right: 5px;" onclick="viewService(${service.id})">View</button>
                        ${service.status === 'pending' ? 
                            `<button class="btn-secondary" style="padding: 6px 12px; font-size: 12px;" onclick="approveService(${service.id})">Approve</button>` : 
                            `<button class="btn-secondary" style="padding: 6px 12px; font-size: 12px;" onclick="suspendService(${service.id})">Suspend</button>`
                        }
                    </td>
                </tr>
            `).join('');
        }

        function setupServiceFilters() {
            const filters = ['searchServices', 'categoryFilter', 'statusFilter', 'sortBy'];
            filters.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('change', loadServicesPage);
                }
            });
        }

        function setupServiceTabs() {
            const tabBtns = document.querySelectorAll('.tab-btn');
            const tabContents = document.querySelectorAll('.tab-content');

            tabBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const tabName = this.dataset.tab;
                    
                    tabBtns.forEach(b => b.classList.remove('active'));
                    tabContents.forEach(c => c.classList.remove('active'));
                    
                    this.classList.add('active');
                    document.getElementById(tabName).classList.add('active');
                });
            });
        }

        function setupServiceModals() {
            const approvalModal = document.getElementById('approvalModal');
            const approvalForm = document.getElementById('approvalForm');
            const approvalAction = document.getElementById('approvalAction');

            approvalAction.addEventListener('change', function() {
                const rejectionGroup = document.getElementById('rejectionReasonGroup');
                if (this.value === 'reject') {
                    rejectionGroup.style.display = 'block';
                } else {
                    rejectionGroup.style.display = 'none';
                }
            });

            approvalForm.addEventListener('submit', function(e) {
                e.preventDefault();
                window.showNotification('Service approval processed!', 'success');
                approvalModal.classList.remove('show');
                loadServicesPage();
            });
        }

        function viewService(serviceId) {
            const modal = document.getElementById('serviceModal');
            modal.classList.add('show');
        }

        function approveService(serviceId) {
            const modal = document.getElementById('approvalModal');
            document.getElementById('serviceId').value = serviceId;
            modal.classList.add('show');
        }

        function suspendService(serviceId) {
            if (confirm('Are you sure you want to suspend this service?')) {
                window.showNotification('Service suspended', 'warning');
                loadServicesPage();
            }
        }
    </script>
</body>
</html>